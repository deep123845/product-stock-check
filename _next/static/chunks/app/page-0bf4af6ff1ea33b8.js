(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{144:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>S});var s=t(5155),a=t(2115);let l=e=>{let r=e.match(/^(\d{2})-(\d{4})$/);if(!r)return -1;let t=Number.parseInt(r[1]);return(Number.parseInt(r[2])-2024)*12+(t-1)},o=e=>{let r=2024+Math.floor((e+1-1)/12),t=(e+1-1)%12+1;return t<10?"0".concat(t,"-").concat(r):"".concat(t,"-").concat(r)},c=()=>{let e=new Date().getMonth()+1,r=new Date().getFullYear();return e<10?"0".concat(e,"-").concat(r):"".concat(e,"-").concat(r)},d=()=>l(c()),n=e=>{let r=d(),t=[];for(let s=0;s<e&&!(s>r);s++)t.push(r-s);return t},i=e=>{let{onFileContentChange:r}=e,[t,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),n=e=>/^\d{2}-\d{4}$/.test(e),i=e=>{let r=[];for(let t=0;t<e.length;t++){let s=e[t].split("	"),a=s[0],o=s[2],c=parseInt(s[3]),d={},i=[];for(let e=4;e<s.length;e++)if(n(s[e])){let r=l(s[e]);d[r]=0,i.push(r)}else break;let m=s.findIndex(e=>"Sold Qty"===e)+1;for(let e=0;e<i.length;e++)d[i[e]]=parseInt(s[m+e]);r.push({productNo:a,description:o,stock:c,sales:d})}return r},m=e=>{let r=[];for(let t=4;t<e.length;t++){let s=e[t-1].split("	"),a=e[t].split("	"),l=s.slice(-4).join("	")+a.slice(0,-4).join("	");r.push(l)}return r},h=e=>e.split("\n").filter(e=>e.length>0);return(0,s.jsxs)("div",{className:"p-4 border rounded shadow mt-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Upload and Parse Text File:"}),(0,s.jsx)("input",{type:"file",accept:".txt",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){o(s.name),d(null);let e=new FileReader;e.onload=e=>{if(e.target&&"string"==typeof e.target.result){let t=e.target.result;r&&r(i(m(h(t))))}},e.onerror=()=>{d("Failed to read file."),r&&r([])},e.readAsText(s)}else o(null),d("No file selected."),r&&r([])},className:"mb-4"}),c&&(0,s.jsxs)("div",{className:"text-red-500 mb-2",children:["Error: ",c]}),t&&(0,s.jsxs)("p",{className:"mb-2",children:["Selected file: ",(0,s.jsx)("span",{className:"font-semibold",children:t})]})]})},m=e=>e/new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate(),h=e=>{let r=Object.keys(e).map(Number);return{firstMonth:Math.min(...r),lastMonth:Math.max(...r)}},u=(e,r,t)=>{let s={},a=d();for(let l=0;l<e.length;l++){let o=e[l];s[o.productNo]=[];let c=h(o.sales);for(let e=c.lastMonth;e>=c.firstMonth;e--)if(t||e!==a){if(s[o.productNo].length>=r&&r>0)break;s[o.productNo].push(e)}}return s},p=(e,r,t)=>{let s={},a=m(t),l=d();for(let t=0;t<e.length;t++){let o=e[t],c=o.productNo,d=o.sales,n=0,i=0;for(let e of r[c])i+=d[e]||0,e===l?n+=a:n++;0===n?s[c]=0:s[c]=i/n}return s},b=(e,r,t,s)=>{let a={},l=0;for(let o=0;o<e.length;o++){let c=e[o],d=c.productNo,n=c.stock||0,i=t[d],m=Math.max(0,r/4*i-n)/(s[d]||1);a[d]=m,l+=m}return{restockAmounts:a,restockAmountsTotal:l}},x=(e,r,t,s,a,l,o)=>{if(!e||0===e.length)return{restockList:{},restockTotal:0};let c={},d=0;for(let n=1;n<=r;n++){let{restockAmounts:r}=b(e,n,t,s);Object.keys(a).forEach(e=>{a[e]&&delete r[e]});for(let t=0;t<e.length;t++){let a=e[t],o=a.productNo;if(r[o]){if(l[o]){let e=a.stock/s[o],t=Math.max(l[o]-e,0);r[o]=Math.min(t,r[o])}c[o]&&(r[o]=r[o]-c[o])}}for(;d<o;){let e=Object.keys(r).reduce((e,t)=>r[e]>r[t]?e:t);if(r[e]<.01)break;c[e]||(c[e]=0),c[e]+=1,r[e]-=1,d+=1}}let n={};for(let e of Object.keys(c).sort((e,r)=>c[r]-c[e]))n[e]=c[e];return{restockList:n,restockTotal:d}},g=(e,r)=>{let t={};for(let s in e){if(!r[s]){t[s]=0;continue}t[s]=e[s]/r[s]}return t},N=(e,r)=>e&&0!==e.length?Object.keys(r).reduce((e,t)=>e+(r[t]||0),0):0,f=(e,r)=>{if(!e||0===e.length)return 0;let t=0;for(let s of e)s.stock&&r[s.productNo]&&(t+=s.stock/r[s.productNo]);return t},j=e=>e&&0!==e.length?e.reduce((e,r)=>e+(r.stock||0),0):0,k=(e,r,t,s,a,l,o,c,d,n)=>{let i=u(e,t,s),m=p(e,i,a),h=g(m,l),{restockAmounts:k,restockAmountsTotal:y}=b(e,o,m,l),{restockList:v,restockTotal:S}=x(e,o,m,l,c,d,n),P=j(e),C=f(e,l),w=N(e,m),M=N(e,h),O=[];for(let t of e){let e=r.find(e=>e.UPC===t.productNo);e||(e={LCBONumber:"",unitsPerCase:0,UPC:"",wholesalePrice:0,supplier:""});let s=l[t.productNo]||0,a=s>0?(t.stock||0)/s:0,o={...t,stockPerPack:a,restockRequired:k[t.productNo]||0,restockReccomended:v[t.productNo]||0,averageSales:m[t.productNo]||0,averageSalesPerPack:h[t.productNo]||0,supplier:e.supplier||"",unitsPerPack:s,LCBONumber:e.LCBONumber||"",wholesalePrice:e.wholesalePrice||0,includedMonths:i[t.productNo]||[],productDisabled:!!c[t.productNo],maxStock:d[t.productNo]||0};O.push(o)}return{totalStatistics:{productNo:"0",description:"Total",stock:P,stockPerPack:C,restockRequired:y||0,restockReccomended:S||0,averageSales:w,averageSalesPerPack:M,supplier:"",sales:{},unitsPerPack:0,LCBONumber:"",wholesalePrice:0,includedMonths:[],productDisabled:!1,maxStock:0},productStatistics:O}},y=e=>{let{productHistory:r,productInfo:t}=e,[l,c]=(0,a.useState)(0),[d,i]=(0,a.useState)(!0),[m,h]=(0,a.useState)(new Date().getDate()),[u,p]=(0,a.useState)(4),[b,x]=(0,a.useState)({}),[g,N]=(0,a.useState)({}),[f,j]=(0,a.useState)(45),[y,v]=(0,a.useState)({}),[S,P]=(0,a.useState)(!0),[C,w]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("unitsPerPack");e&&x(JSON.parse(e));let r=localStorage.getItem("productDisabled");r&&N(JSON.parse(r));let t=localStorage.getItem("maxStockPerProduct");t&&v(JSON.parse(t))},[]);let M=(()=>{let e={...b};if(t)for(let r of t)void 0===e[r.UPC]&&(e[r.UPC]=r.unitsPerCase);return e})(),O=n(24),F=n(2),{totalStatistics:I,productStatistics:D}=k(r,t,l,d,m,M,u,g,y,f),R=(e,r)=>{let t=e.target.value,s={...b,[r]:t?parseInt(t):-1};x(s),localStorage.setItem("unitsPerPack",JSON.stringify(s))},E=(e,r)=>{let t=e.target.value,s={...y,[r]:t?parseInt(t):-1};v(s),localStorage.setItem("maxStockPerProduct",JSON.stringify(s))},L=e=>{let r={...g,[e]:!g[e]};N(r),localStorage.setItem("productDisabled",JSON.stringify(r))};return(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",className:"border border-gray-300 p-2 w-1/8 mr-2",placeholder:"Enter number of months to average",value:l,onChange:e=>{let r=e.target.value;c(r?parseInt(r):0)},min:"0"}),(0,s.jsx)("p",{className:"text-l font-bold",children:"Number of Months to average sales over (0 means average over all available data)"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",className:"border border-gray-300 p-2 mr-2",checked:d,onChange:e=>{i(e.target.checked)}}),(0,s.jsx)("p",{className:"text-l font-bold",children:"Include current month (current month is usually partial)"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",className:"border border-gray-300 p-2 w-1/8 mr-2",placeholder:"Enter day of month of report",value:m,onChange:e=>{let r=e.target.value;h(r?parseInt(r):0)},min:"1",max:"31"}),(0,s.jsx)("p",{className:"text-l font-bold",children:"Day of month at time of report"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",className:"border border-gray-300 p-2 w-1/8 mr-2",placeholder:"Enter number of weeks to restock",value:u,onChange:e=>{let r=e.target.value;p(r?parseInt(r):0)},min:"1"}),(0,s.jsx)("p",{className:"text-l font-bold",children:"Weeks to restock"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"number",className:"border border-gray-300 p-2 w-1/8 mr-2",placeholder:"Enter max packs to restock",value:f,onChange:e=>{let r=e.target.value;j(r?parseInt(r):45)},min:"1"}),(0,s.jsx)("p",{className:"text-l font-bold",children:"Max packs to restock"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",className:"border border-gray-300 p-2 mr-2",checked:C,onChange:()=>{w(!C)}}),(0,s.jsx)("p",{className:"text-l font-bold",children:"Show average monthly sales in packs"})]}),(0,s.jsxs)("div",{className:"my-2",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-2",children:["Total Average Monthly Sales: ",C?I.averageSalesPerPack.toFixed(2):I.averageSales.toFixed(2)," packs"]}),(0,s.jsxs)("h2",{className:"text-xl font-bold mb-2",children:["Total Stock: ",C?I.stockPerPack.toFixed(2):I.stock.toFixed(2)," packs"]})]}),(0,s.jsx)("div",{className:"flex items-center mb-4",children:(0,s.jsx)("button",{className:"bg-gray-500 text-white p-2 rounded mr-2",onClick:()=>{P(!S)},children:S?"Hide Table":"Show Table"})}),S&&(0,s.jsx)("div",{children:(0,s.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"LCBO Number"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Disable"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Units/Pack"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Description"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Stock"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Avg Monthly Sales"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Restock (Packs)"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Maximum Stock"}),O.map(e=>(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:o(e)},e))]})}),(0,s.jsx)("tbody",{children:D.map((e,r)=>(0,s.jsxs)("tr",{className:r%2==0?"bg-black":"bg-gray-800",children:[(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.LCBONumber}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:(0,s.jsx)("input",{type:"checkbox",className:"border border-gray-300 p-2",checked:g[e.productNo]||!1,onChange:()=>L(e.productNo)})}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:(0,s.jsx)("input",{type:"number",className:"border border-gray-300 p-2 w-[100%]",value:M[e.productNo]||"",onChange:r=>R(r,e.productNo),min:"0"})}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.description}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.stock}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:C?e.averageSalesPerPack.toFixed(2):e.averageSales.toFixed(2)}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.restockRequired.toFixed(2)}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:(0,s.jsx)("input",{type:"number",className:"border border-gray-300 p-2 w-[100%]",value:e.maxStock||"",onChange:r=>E(r,e.productNo),min:"0"})}),O.map(r=>(0,s.jsx)("td",{className:"border border-gray-300 p-2 ".concat(e.includedMonths.includes(r)?"text-green-500":"text-red-500"),children:e.sales[r]||0},r))]},r))})]})}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-2",children:["Restock List: ",I.restockReccomended]}),(0,s.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"LCBO Number"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Description"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Restock Amount (Packs)"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Stock"}),(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:"Avg Monthly Sales"}),F.map(e=>(0,s.jsx)("th",{className:"border border-gray-300 p-2",children:o(e)},e))]})}),(0,s.jsx)("tbody",{children:D.filter(e=>e.restockReccomended>0).sort((e,r)=>r.restockReccomended-e.restockReccomended).map((e,r)=>(0,s.jsxs)("tr",{className:r%2==0?"bg-black":"bg-gray-800",children:[(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.LCBONumber||"N/A"}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.description||"N/A"}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.restockReccomended}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:e.stock||0}),(0,s.jsx)("td",{className:"border border-gray-300 p-2",children:C?e.averageSalesPerPack.toFixed(2):e.averageSales.toFixed(2)}),F.map(r=>(0,s.jsx)("td",{className:"border border-gray-300 p-2 ".concat(e.includedMonths.includes(r)?"text-green-500":"text-red-500"),children:e.sales[r]||0},r))]},r))})]})]})]})},v=e=>{let{onFileContentChange:r}=e,[t,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),d=e=>{let r=e.split("\n").filter(e=>e.length>0).map(e=>{let r=e.split(","),t=r[0].split('"')[1],s=parseInt(r[3].trim()),a=r[7].split('"')[1];return{LCBONumber:t,unitsPerCase:s,UPC:a,wholesalePrice:parseFloat(r[15].split('"')[1]),supplier:r[20].trim()}});return[...r.slice(1)]};return(0,s.jsxs)("div",{className:"p-4 border rounded shadow mt-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Upload and Parse Catalogue File:"}),(0,s.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];if(s){l(s.name),c(null);let e=new FileReader;e.onload=e=>{if(e.target&&"string"==typeof e.target.result){let t=e.target.result;r&&r(d(t))}},e.onerror=()=>{c("Failed to read file."),r&&r([])},e.readAsText(s)}else l(null),c("No file selected."),r&&r([])},className:"mb-4"}),o&&(0,s.jsxs)("div",{className:"text-red-500 mb-2",children:["Error: ",o]}),t&&(0,s.jsxs)("p",{className:"mb-2",children:["Selected file: ",(0,s.jsx)("span",{className:"font-semibold",children:t})]})]})};function S(){let[e,r]=(0,a.useState)([]),[t,l]=(0,a.useState)([]);return(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-center mt-8",children:"Product Stock Check"}),(0,s.jsx)("p",{className:"text-center mt-4",children:"Upload a text file to check product stock."}),(0,s.jsx)(v,{onFileContentChange:e=>{l(e)}}),(0,s.jsx)(i,{onFileContentChange:e=>{r(e)}}),(0,s.jsx)(y,{productHistory:e,productInfo:t})]})}},6777:(e,r,t)=>{Promise.resolve().then(t.bind(t,144))}},e=>{var r=r=>e(e.s=r);e.O(0,[441,684,358],()=>r(6777)),_N_E=e.O()}]);